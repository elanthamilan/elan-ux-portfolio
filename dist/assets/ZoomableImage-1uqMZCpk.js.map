{"version":3,"file":"ZoomableImage-1uqMZCpk.js","sources":["../../src/components/ui/ZoomableImage.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect, useCallback } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { X } from 'lucide-react';\r\nimport { usePrefersReducedMotion } from '../hooks/usePrefersReducedMotion'; // Import the hook\r\n\r\ninterface ZoomableImageProps {\r\n  src: string;\r\n  alt: string;\r\n  className?: string;\r\n}\r\n\r\nconst ZoomableImage: React.FC<ZoomableImageProps> = React.memo(({ src, alt, className = '' }) => { // Wrapped with React.memo\r\n  const [isZoomed, setIsZoomed] = useState(false);\r\n  const [position, setPosition] = useState({ x: 0, y: 0 });\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const imageRef = useRef<HTMLImageElement>(null);\r\n  const prefersReducedMotion = usePrefersReducedMotion(); // Use the hook\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const closeButtonRef = useRef<HTMLButtonElement>(null);\r\n\r\n  const handleClose = useCallback(() => { // Wrapped handleClose with useCallback\r\n    setIsZoomed(false);\r\n    containerRef.current?.focus();\r\n  }, []); // No dependencies as setIsZoomed is stable and containerRef is a ref\r\n\r\n  const handleClick = useCallback(() => { // Wrapped handleClick with useCallback\r\n    if (!isLoading) {\r\n      setIsZoomed(prevIsZoomed => !prevIsZoomed); // Use functional update for setIsZoomed\r\n    }\r\n  }, [isLoading]); // Dependency: isLoading\r\n\r\n  const handleKeyDown = useCallback((e: React.KeyboardEvent) => { // Wrapped handleKeyDown with useCallback\r\n    if (e.key === 'Escape' && isZoomed) {\r\n      handleClose();\r\n    } else if ((e.key === 'Enter' || e.key === ' ') && !isLoading) {\r\n      e.preventDefault();\r\n      handleClick();\r\n    }\r\n  }, [isZoomed, isLoading, handleClose, handleClick]); // Dependencies: isZoomed, isLoading, handleClose, handleClick\r\n\r\n  const handleMouseMove = useCallback((e: React.MouseEvent<HTMLDivElement>) => { // Wrapped handleMouseMove with useCallback\r\n    if (!containerRef.current || !imageRef.current || !isZoomed) return;\r\n\r\n    const { left, top, width, height } = containerRef.current.getBoundingClientRect();\r\n    const x = ((e.clientX - left) / width) * 100;\r\n    const y = ((e.clientY - top) / height) * 100;\r\n    setPosition({ x, y });\r\n  }, [isZoomed]); // Dependency: isZoomed\r\n\r\n  useEffect(() => {\r\n    // Define event handlers within useEffect or ensure they are stable via useCallback if defined outside\r\n    // For this effect, handleClickOutside and handleEscapeAndTab are only relevant when isZoomed is true\r\n    // and are re-added/removed based on isZoomed.\r\n    // handleClose is already memoized with useCallback.\r\n\r\n    const localHandleClickOutside = (e: MouseEvent) => {\r\n      if (containerRef.current && !containerRef.current.contains(e.target as Node)) {\r\n        handleClose(); // handleClose is stable\r\n      }\r\n    };\r\n\r\n    const localHandleEscapeAndTab = (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape') {\r\n        handleClose(); // handleClose is stable\r\n      } else if (e.key === 'Tab') {\r\n        if (closeButtonRef.current && document.activeElement === closeButtonRef.current) {\r\n          e.preventDefault();\r\n        } else if (closeButtonRef.current) {\r\n          closeButtonRef.current.focus();\r\n          e.preventDefault();\r\n        }\r\n      }\r\n    };\r\n\r\n    if (isZoomed) {\r\n      document.addEventListener('mousedown', localHandleClickOutside);\r\n      document.addEventListener('keydown', localHandleEscapeAndTab);\r\n      const timer = setTimeout(() => {\r\n        closeButtonRef.current?.focus();\r\n      }, 100);\r\n      return () => {\r\n        clearTimeout(timer);\r\n        document.removeEventListener('mousedown', localHandleClickOutside);\r\n        document.removeEventListener('keydown', localHandleEscapeAndTab);\r\n      };\r\n    }\r\n    // No explicit cleanup needed for the 'else' case here if listeners are only added when isZoomed\r\n  }, [isZoomed, handleClose]); // Dependency: isZoomed and the stable handleClose\r\n\r\n  return (\r\n    <div\r\n      ref={containerRef}\r\n      className={`relative overflow-hidden ${!isLoading ? 'cursor-zoom-in' : 'cursor-wait'} ${className} focus:outline-none focus-visible:ring-2 focus-visible:ring-brand-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background rounded-lg`}\r\n      onClick={handleClick}\r\n      onMouseMove={handleMouseMove}\r\n      onKeyDown={handleKeyDown}\r\n      role=\"button\"\r\n      tabIndex={0}\r\n      aria-label={`${isZoomed ? 'Close' : 'Zoom'} image: ${alt}`}\r\n    >\r\n      {isLoading && (\r\n        <div className=\"absolute inset-0 flex items-center justify-center bg-accent-bg dark:bg-slate-800 rounded-lg\"> {/* Themed loading background, added rounded-lg to match image container */}\r\n          <div className=\"w-8 h-8 border-4 border-brand-primary border-t-transparent rounded-full animate-spin\"></div> {/* Ensured border-brand-primary */}\r\n        </div>\r\n      )}\r\n      <img\r\n        ref={imageRef}\r\n        src={src}\r\n        alt={alt}\r\n        className={`w-full h-full object-cover transition-transform duration-300 ${\r\n          isZoomed ? 'scale-150' : 'hover:scale-105'\r\n        } ${isLoading ? 'opacity-0' : 'opacity-100'}`}\r\n        srcSet={\r\n          (() => {\r\n            if (!src) return undefined;\r\n            const baseSrc = src.substring(0, src.lastIndexOf('.'));\r\n            const extension = src.substring(src.lastIndexOf('.'));\r\n            // Common widths for content images\r\n            return [480, 800, 1200, 1600].map(w => `${baseSrc}-${w}w${extension} ${w}w`).join(', ');\r\n          })()\r\n        }\r\n        sizes=\"(max-width: 768px) 100vw, (max-width: 1200px) 70vw, 800px\" // General purpose sizes\r\n        style={\r\n          isZoomed\r\n            ? {\r\n                transformOrigin: `${position.x}% ${position.y}%`,\r\n              }\r\n            : {}\r\n        }\r\n        onLoad={() => setIsLoading(false)}\r\n        loading=\"lazy\" // Already present, good.\r\n      />\r\n\r\n      <AnimatePresence>\r\n        {isZoomed && typeof document !== 'undefined' && createPortal(\r\n          <motion.div\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n            transition={prefersReducedMotion ? { duration: 0 } : { duration: 0.3 }} // Modal fade\r\n            className=\"fixed inset-0 bg-black/95 z-[10000] flex items-center justify-center p-4 backdrop-blur-sm\"\r\n            onClick={handleClose}\r\n            role=\"dialog\"\r\n            aria-modal=\"true\"\r\n            aria-label=\"Zoomed image view\"\r\n          >\r\n            <motion.img\r\n              initial={{ scale: prefersReducedMotion ? 1 : 0.5 }}\r\n              animate={{ scale: 1 }}\r\n              exit={{ scale: prefersReducedMotion ? 1 : 0.5 }}\r\n              transition={prefersReducedMotion ? { duration: 0 } : { duration: 0.3 }} // Image scale\r\n              src={src}\r\n              alt={alt}\r\n              className=\"max-w-full max-h-full object-contain shadow-2xl\"\r\n              onClick={(e) => e.stopPropagation()}\r\n              style={{ maxWidth: '95vw', maxHeight: '95vh' }}\r\n            />\r\n            <button\r\n              ref={closeButtonRef}\r\n              className=\"absolute top-4 right-4 z-[10001] text-white bg-black/50 rounded-full p-3 hover:bg-black/70 focus:outline-none focus:ring-2 focus:ring-white/50 transition-colors backdrop-blur-sm\"\r\n              onClick={handleClose}\r\n              aria-label=\"Close zoomed view (Press Escape)\"\r\n              title=\"Close zoomed view (Press Escape)\"\r\n            >\r\n              <X className=\"w-6 h-6\" />\r\n            </button>\r\n\r\n            {/* Instructions */}\r\n            <div className=\"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white text-sm bg-black/50 px-4 py-2 rounded-full backdrop-blur-sm\">\r\n              Click outside or press Escape to close\r\n            </div>\r\n          </motion.div>,\r\n          document.body\r\n        )}\r\n      </AnimatePresence>\r\n    </div>\r\n  );\r\n});\r\nZoomableImage.displayName = \"ZoomableImage\"; // Optional: for better debugging\r\n\r\nexport default ZoomableImage;"],"names":["ZoomableImage","React","src","alt","className","isZoomed","setIsZoomed","useState","position","setPosition","isLoading","setIsLoading","imageRef","useRef","prefersReducedMotion","usePrefersReducedMotion","containerRef","closeButtonRef","handleClose","useCallback","_a","handleClick","prevIsZoomed","handleKeyDown","handleMouseMove","left","top","width","height","x","y","useEffect","localHandleClickOutside","e","localHandleEscapeAndTab","timer","jsxs","jsx","baseSrc","extension","w","AnimatePresence","createPortal","motion","X"],"mappings":"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"}